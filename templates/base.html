<!doctype html>
<html lang="ru" data-bs-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}SmartGrade{% endblock %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    {% load static %}

    <style>
      html, body { height: 100%; }
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background: #ffffff;
        position: relative;
        overflow-x: hidden;
      }
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: url("{% static 'images/bg_school.png' %}") center/cover no-repeat;
        filter: blur(3px);
        opacity: 0.45;
        z-index: -2;
      }
      body::after {
        content: "";
        position: fixed;
        inset: 0;
        background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.9));
        z-index: -1;
      }
      main {
        flex: 1;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(2px);
        border-radius: 1.2rem;
        margin-top: 2rem;
        margin-bottom: 2rem;
        padding: 2.5rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.05);
      }
      .navbar {
        background: rgba(255,255,255,0.9) !important;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      }
      .navbar-brand { letter-spacing: .3px; }
      .nav-link i { margin-right: .5rem; }
      .home-cards { display: flex; flex-wrap: wrap; justify-content: center; gap: 2rem; margin-top: 3rem; }
      .home-cards .card { width: 340px; min-height: 270px; border: 0; border-radius: 1.2rem; box-shadow: 0 6px 24px rgba(0,0,0,.06); transition: all .25s ease; text-align: center; padding: 2.5rem 1.8rem; background: #fff; }
      .home-cards .card:hover { transform: translateY(-8px); box-shadow: 0 12px 35px rgba(0,0,0,.12); }
      .home-cards i { font-size: 3rem; margin-bottom: 1rem; }
      .home-cards h5 { font-size: 1.4rem; font-weight: 700; margin-bottom: 0.7rem; }
      .home-cards p { font-size: 1rem; color: #6c757d; margin-bottom: 1.3rem; }
      footer { margin-top: auto; background: rgba(255,255,255,0.9); border-top: 1px solid #dee2e6; color: #6c757d; padding: 1rem 0; backdrop-filter: blur(2px); }
      .fade-in { animation: fadeIn 0.8s ease forwards; opacity: 0; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    {% block extra_head %}{% endblock %}
  </head>

  <body>
    <nav class="navbar navbar-expand-lg border-bottom">
      <div class="container">
        <a class="navbar-brand fw-semibold" href="{% url 'dashboard' %}">
          <i class="bi bi-mortarboard-fill text-primary me-1"></i>SmartGrade
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="mainNav">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            {% if request.user.is_authenticated %}
              {% if request.user.role == 'TEACHER' %}
                <li class="nav-item"><a class="nav-link" href="{% url 'academics:lesson_list' %}"><i class="bi bi-journal-text"></i>Уроки</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'academics:subject_list' %}"><i class="bi bi-book-half"></i>Предметы</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'accounts:profile' %}"><i class="bi bi-person"></i> Мой профиль</a></li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown"><i class="bi bi-clipboard2-check"></i>Журнал</a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="{% url 'journal:grade_new' %}"><i class="bi bi-plus-circle me-1"></i>Добавить оценку</a></li>
                    <li><a class="dropdown-item" href="{% url 'journal:attendance_new' %}"><i class="bi bi-person-check me-1"></i>Отметить посещаемость</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="{% url 'journal:teacher_grades' %}"><i class="bi bi-table me-1"></i>Оценки (учитель)</a></li>
                    <li><a class="dropdown-item" href="{% url 'journal:teacher_attendance' %}"><i class="bi bi-people me-1"></i>Посещаемость (учитель)</a></li>
                  </ul>
                </li>
                <li class="nav-item"><a class="nav-link" href="{% url 'reports:student_search' %}"><i class="bi bi-search"></i>Отчеты по ученикам</a></li>
              {% elif request.user.role == 'STUDENT' %}
                <li class="nav-item"><a class="nav-link" href="{% url 'journal:my_grades' %}"><i class="bi bi-book"></i>Мои оценки</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'journal:my_attendance' %}"><i class="bi bi-calendar-check"></i>Моя посещаемость</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'accounts:profile' %}"><i class="bi bi-person"></i> Мой профиль</a></li>
              {% elif request.user.role == 'ADMIN' %}
                <li class="nav-item dropdown">
                <li class="nav-item"><a class="nav-link" href="{% url 'accounts:profile' %}"><i class="bi bi-person"></i> Мой профиль</a></li>
                  <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                    <i class="bi bi-gear-wide-connected"></i>Управление
                  </a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="{% url 'director:user_list' %}"><i class="bi bi-people-fill me-1"></i>Пользователи</a></li>
                    <li><a class="dropdown-item" href="{% url 'director:class_list' %}"><i class="bi bi-building me-1"></i>Классы</a></li>
                    <li><a class="dropdown-item" href="{% url 'director:subject_list' %}"><i class="bi bi-book-half me-1"></i>Предметы</a></li>
                    <li><a class="dropdown-item" href="{% url 'reports:student_search' %}"><i class="bi bi-search"></i>Отчеты по ученикам</a></li>
                    <li><a class="dropdown-item" href="{% url 'director:lesson_add' %}"><i class="bi bi-calendar-plus me-1"></i>Добавить урок</a></li>
                    <li><a class="dropdown-item" href="{% url 'director:lesson_list' %}"><i class="bi bi-journal-text me-1"></i>Уроки</a></li>
                  </ul>
                </li>
              {% endif %}
            {% endif %}
            
          </ul>

          <div class="d-flex align-items-center gap-2">
            {% if request.user.is_authenticated %}
              <span class="text-muted small">
                <i class="bi bi-person-circle me-1"></i>{{ request.user.email }}
                {% if request.user.role %} · {{ request.user.role }}{% endif %}
              </span>
              <form method="post" action="{% url 'accounts:logout' %}" class="m-0">
                {% csrf_token %}
                <button class="btn btn-outline-secondary btn-sm">
                  <i class="bi bi-box-arrow-right me-1"></i>Выйти
                </button>
              </form>
            {% else %}
              <a class="btn btn-primary btn-sm" href="{% url 'accounts:login' %}"><i class="bi bi-box-arrow-in-right me-1"></i>Войти</a>
            {% endif %}
          </div>
        </div>
      </div>
    </nav>

    <main class="container fade-in">
      {% if messages %}
        {% for m in messages %}
          <div class="alert alert-{{ m.tags }}">{{ m }}</div>
        {% endfor %}
      {% endif %}
      {% block content %}{% endblock %}
    </main>

    <footer>
      <div class="container d-flex justify-content-between small">
        <span>© SmartGrade</span>
        <span>Bootstrap · Bootstrap Icons</span>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    {% block extra_js %}{% endblock %}
  </body>
</html>
